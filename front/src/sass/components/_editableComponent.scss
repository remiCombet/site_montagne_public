@use '../utils/variables' as vars;
@use '../utils/mixins' as mix;

// Variables communes pour les composants éditables
$item-active-bg: rgba(vars.$primary-color, 0.08);
$item-active-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

// Composant éditable générique - styles partagés par tous les composants d'administration
.editable-component {
  width: 100%;
  background-color: vars.$white;
  border-radius: vars.$border-radius;
  box-shadow: vars.$box-shadow;
  margin-bottom: vars.$spacing-xl;
  overflow: hidden;
  
  // ======= MODE AFFICHAGE (MOBILE FIRST) =======
  .view-mode {
    // Version mobile par défaut
    @include mix.flex(column, flex-start, stretch);
    padding: vars.$spacing-md;
    position: relative;
    border-radius: vars.$border-radius;
    background-color: vars.$background-light;
    box-shadow: vars.$box-shadow;
    
    .component-header {
      width: 100%;
      margin-bottom: vars.$spacing-md;
      padding-bottom: vars.$spacing-sm;
      
      h3 {
        margin: 0 0 vars.$spacing-sm 0;
        color: vars.$primary-color;
        font-size: vars.$font-size-h4;
      }
      
      .empty-message {
        color: vars.$text-color-tertiary;
        font-style: italic;
        margin: vars.$spacing-sm 0;
      }
    }
    
    .component-action {
      @include mix.flex(row, center, center);
      width: 100%;
      text-align: center;
      margin-top: vars.$spacing-md;
      
      .btn-primary {
        width: 100%;
        max-width: 200px;
      }
    }
    
    // Adaptation pour tablette et desktop
    @include mix.for-size('tablet') {
      @include mix.flex(row, space-between, stretch);
      
      .component-header {
        margin-bottom: 0;
        flex: 1;
      }
      
      .component-action {
        @include mix.flex(row, flex-end, center);
        padding-left: vars.$spacing-md;
        width: auto;
        
        .btn-primary {
          width: auto;
        }
      }
    }
  }
  
  // ======= MODE ÉDITION (MOBILE FIRST) =======
  .edit-mode {
    padding: vars.$spacing-md;
    position: relative;
    
    // Correction majeure: forcer le mode d'affichage en bloc standard
    // au lieu de flex qui peut créer des problèmes d'alignement
    display: block !important; 
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: vars.$spacing-md;
      
      h3 {
        margin: 0;
        color: vars.$primary-color;
        font-size: vars.$font-size-h4;
        font-weight: 700;
      }
    }
    
    .alert {
      margin-bottom: vars.$spacing-md;
      padding: vars.$spacing-sm;
      border-radius: vars.$border-radius;
      width: 100%;
      
      &.alert-success {
        @include mix.alert-box(vars.$success-color);
        padding: vars.$spacing-sm;
      }
      
      &.alert-danger {
        @include mix.alert-box(vars.$error-color);
        padding: vars.$spacing-sm;
      }
      
      &.alert-warning {
        @include mix.alert-box(vars.$warning-color);
        padding: vars.$spacing-sm;
      }
      
      &.alert-info {
        @include mix.alert-box(vars.$info-color);
        padding: vars.$spacing-sm;
      }
    }
    
    // Sections de formulaire
    .form-section {
      margin-bottom: vars.$spacing-lg;
      width: 100%;
      background-color: vars.$white;
      padding: vars.$spacing-md;
      border-radius: vars.$border-radius;
      margin-bottom: vars.$spacing-md;
      box-shadow: vars.$box-shadow;
      
      h4 {
        margin-top: 0;
        margin-bottom: vars.$spacing-sm;
        color: vars.$text-color-secondary;
        font-size: vars.$font-size-base;
        border-left: vars.$border-width-lg solid vars.$primary-color;
        padding-left: vars.$spacing-sm;
        width: 100%;
      }
    }
    
    // Conteneurs de listes
    .list-section {
      margin-bottom: vars.$spacing-lg;
      width: 100%;
      
      h4 {
        margin-top: 0;
        margin-bottom: vars.$spacing-sm;
        color: vars.$text-color-secondary;
        font-size: vars.$font-size-base;
        border-left: vars.$border-width-lg solid vars.$primary-color;
        padding-left: vars.$spacing-sm;
      }
      
      .list-container {
        list-style: none;
        padding: 0;
        margin: vars.$spacing-md 0 0;
        width: 100%;
        
        .list-item {
          @include mix.flex(column, flex-start, stretch);
          margin-bottom: vars.$spacing-sm;
          padding: vars.$spacing-sm;
          background-color: vars.$white;
          border-radius: vars.$border-radius;
          border-left: vars.$border-width-lg solid vars.$primary-color;
          width: 100%;
          
          .item-content {
            margin-bottom: vars.$spacing-sm;
            
            .item-title {
              display: block;
              color: vars.$primary-color;
              margin-bottom: vars.$spacing-xs;
              font-weight: 600;
            }
            
            .item-description {
              display: block;
              color: vars.$text-color;
              font-size: vars.$font-size-sm;
            }
          }
          
          .item-actions {
            @include mix.flex(row, flex-end, center);
            gap: vars.$spacing-xs;
            
            .btn-sm {
              padding: vars.$spacing-xs vars.$spacing-sm;
              font-size: vars.$font-size-sm;
            }
          }
          
          // Adaptation pour tablette et desktop
          @include mix.for-size('tablet') {
            @include mix.flex(row, space-between, center);
            
            .item-content {
              margin-bottom: 0;
              flex: 1;
            }
            
            .item-actions {
              @include mix.flex(row, flex-end, center);
            }
          }
        }
      }
    }
    
    .empty-message {
      color: vars.$text-color-tertiary;
      font-style: italic;
      margin: vars.$spacing-md 0 0;
      width: 100%;
    }
    
    // Groupes de formulaires
    .form-group {
      margin-bottom: vars.$spacing-md;
      width: 100%;
      
      label {
        display: block;
        margin-bottom: vars.$spacing-xs;
        font-weight: 500;
        width: 100%;
      }
      
      .text-input,
      .text-area {
        width: 100%;
        padding: vars.$spacing-sm;
        border: vars.$border-width solid vars.$border-color;
        border-radius: vars.$border-radius;
        
        &:focus {
          outline: none;
          border-color: vars.$primary-color;
        }
      }
      
      .form-help {
        display: block;
        margin-top: vars.$spacing-xs;
        color: vars.$text-color-tertiary;
        font-size: vars.$font-size-sm;
      }
    }
    
    // Actions du formulaire (boutons)
    .form-actions {
      margin-top: vars.$spacing-md;
      @include mix.flex(column, center, center);
      gap: vars.$spacing-sm;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: vars.$spacing-md;
      padding: 0;
      
      button {
        width: 100%;
        max-width: 300px;
        min-width: 200px;
      }
      
      // Adaptation pour tablette et desktop
      @include mix.for-size('tablet') {
        @include mix.flex(row, center, center);
        gap: vars.$spacing-md;
        
        button {
          width: auto;
        }
      }
      
      @include mix.for-size-down('mobile') {
        flex-direction: column;
        
        button {
          width: 100%;
        }
      }
    }
    
    // Pied de page du mode édition
    .edit-footer {
      margin-top: vars.$spacing-lg;
      padding-top: vars.$spacing-md;
      border-top: vars.$border-width dashed vars.$border-color;
      display: flex;
      justify-content: center;
      width: 100%;
      
      .btn-primary {
        width: 100%;
        max-width: 200px;
        
        @include mix.for-size('tablet') {
          width: auto;
        }
      }
    }
    
    // Zone de danger (suppression, etc.)
    .danger-zone {
      border: vars.$border-width dashed vars.$error-color;
      padding: vars.$spacing-md;
      border-radius: vars.$border-radius;
      margin-top: vars.$spacing-xl;
      width: 100%;
      
      h4 {
        color: vars.$error-color;
        border-left-color: vars.$error-color;
      }
      
      p {
        margin-bottom: vars.$spacing-md;
      }
    }
    
    // Confirmation de suppression
    .delete-confirmation {
      background-color: rgba(vars.$error-color, 0.05);
      border: vars.$border-width solid vars.$error-color;
      padding: vars.$spacing-md;
      border-radius: vars.$border-radius;
      margin: vars.$spacing-lg 0;
      width: 100%;
      
      h4 {
        color: vars.$error-color;
        border-left: none;
        padding-left: 0;
        margin-top: 0;
      }
      
      p {
        margin-bottom: vars.$spacing-sm;
      }
      
      .action-buttons {
        @include mix.flex(column, center, stretch);
        gap: vars.$spacing-sm;
        margin-top: vars.$spacing-md;
        width: 100%;
        
        button {
          width: 100%;
        }
        
        @include mix.for-size('tablet') {
          @include mix.flex(row, center, center);
          gap: vars.$spacing-md;
          
          button {
            width: auto;
          }
        }
      }
    }
    
    // CORRECTION IMPORTANTE: Assurez-vous que tous les formulaires et sections de formulaires
    // utilisent toute la largeur disponible
    form, 
    .step-form-section, 
    .highlight-form-section,
    .theme-form-section,
    .image-form-section,
    .step-form, 
    .highlight-form,
    .theme-form,
    .image-form {
      width: 100%;
      max-width: 100%;
      display: block;
      margin-left: 0;
      margin-right: 0;
    }
    
    // En mode tablette/desktop, annuler les effets de mise en page flex qui pourraient
    // causer des problèmes d'alignement
    @include mix.for-size('tablet') {
      display: block !important;
      
      .form-section, 
      .list-section {
        display: block;
        width: 100%;
      }
    }
    
    // Réinitialisation des listes pour tous les menus dans les composants éditables
    menu {
      list-style: none;
      padding: 0;
      margin: 0;
      
      li {
        list-style: none;
        padding: 0;
        margin: 0;
      }
    }
    
    // Style commun pour les boutons actifs
    .btn-outline-primary.active {
      background-color: rgba(vars.$primary-color, 0.1);
      font-weight: 600;
    }
    
    // Style commun pour les éléments actifs en édition
    .active-edit {
      background-color: $item-active-bg !important;
      border-left-width: calc(vars.$border-width-lg * 1.5) !important;
      transform: translateX(vars.$spacing-xs) !important;
      box-shadow: $item-active-shadow !important;
    }
    
    // Style commun pour les formulaires en mode édition
    .is-editing {
      border-left: vars.$border-width-lg solid vars.$primary-color !important;
      background-color: $item-active-bg !important;
      padding: vars.$spacing-md !important;
      border-radius: vars.$border-radius !important;
      box-shadow: $item-active-shadow !important;
      
      .editing-indicator {
        display: inline-block !important;
        background: vars.$primary-color !important;
        color: vars.$white !important;
        padding: vars.$spacing-xs vars.$spacing-sm !important;
        border-radius: vars.$border-radius-pill !important;
        margin-bottom: vars.$spacing-sm !important;
        font-size: vars.$font-size-sm !important;
        opacity: 1 !important;
      }
    }
    
    // Style pour masquer l'indicateur d'édition par défaut
    .editing-indicator {
      opacity: 0;
      @include mix.smooth-transition(all);
    }
  }
}